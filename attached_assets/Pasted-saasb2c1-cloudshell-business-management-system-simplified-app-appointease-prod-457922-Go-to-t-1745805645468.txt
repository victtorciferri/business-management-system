saasb2c1@cloudshell:~/business-management-system/simplified-app (appointease-prod-457922)$ # Go to the simplified app directory
cd ~/business-management-system/simplified-app

# Let's create a direct migration script that will migrate the data from Neon to Cloud SQL
cat > migrate-neon-to-cloudsql.js << 'EOF'
const { Pool } = require('pg');

// Source (Neon) database connection string
const SOURCE_DB_URL = 'postgresql://neondb_owner:npg_wrbc48eRdZmf@ep-divine-field-a42drrxe.us-east-1.aws.neon.tech/neondb?sslmode=require';

// Target (Local Cloud SQL) database connection
const TARGET_DB_URL = 'postgresql://postgres:postgres@localhost/postgres';

async function migrateData() {
  console.log('Starting migration from Neon to Cloud SQL...');
  console.log('Source database: Neon PostgreSQL');
  console.log('Target database: Google Cloud SQL (via localhost proxy)');
  
  // Create database pool connections
  const sourcePool = new Pool({
    connectionString: SOURCE_DB_URL,
    ssl: { rejectUnauthorized: false }
  });
  
  const targetPool = new Pool({
    connectionString: TARGET_DB_URL
  });
  
  try {
    // Test connections
    console.log('\nTesting source database connection...');
    try {
      const sourceClient = await sourcePool.connect();
      const sourceTest = await sourceClient.query('SELECT NOW() as time');
      console.log('✅ Source database connected! Server time:', sourceTest.rows[0].time);
      sourceClient.release();
    } catch (err) {
  --add-cloudsql-instances=${INSTANCE_CONNECTION_NAME}\pointease-secret-key,CLOUD_SQL_CONNECTION_NAME=${INSTANCE_CONNECTION_NAME}" \

up to date, audited 97 packages in 818ms

14 packages are looking for funding
  run `npm fund` for details

found 0 vulnerabilities
Your active configuration is: [cloudshell-14847]
[1] 3350
2025/04/28 01:58:58 This is the Cloud SQL Proxy v1. It is no longer receiving active feature development. For the latest features and improvements, migrate to the v2 version of the Cloud SQL Proxy. For details, see: https://github.com/GoogleCloudPlatform/cloud-sql-proxy/blob/main/migration-guide.md
2025/04/28 01:58:58 current FDs rlimit set to 1048575, wanted limit is 8500. Nothing to do here.
2025/04/28 01:59:01 Listening on 127.0.0.1:5432 for appointease-prod-457922:southamerica-west1:appointease-db
2025/04/28 01:59:01 Ready for new connections
2025/04/28 01:59:02 Generated RSA key in 416.05729ms
Starting migration from Neon to Cloud SQL...
Source database: Neon PostgreSQL
Target database: Google Cloud SQL (via localhost proxy)

Testing source database connection...
✅ Source database connected! Server time: 2025-04-28T01:59:05.176Z

Testing target database connection...
2025/04/28 01:59:05 New connection for "appointease-prod-457922:southamerica-west1:appointease-db"
2025/04/28 01:59:05 refreshing ephemeral certificate for instance appointease-prod-457922:southamerica-west1:appointease-db
2025/04/28 01:59:07 Scheduling refresh of ephemeral certificate in 54m59s
❌ Migration error: Target database connection failed: password authentication failed for user "postgres"
2025/04/28 01:59:07 Instance appointease-prod-457922:southamerica-west1:appointease-db closed connection
2025/04/28 01:59:07 Received TERM signal. Waiting up to 0s before terminating.
[1]+  Done                    ./cloud_sql_proxy -instances=${INSTANCE_CONNECTION_NAME}=tcp:5432
Building using Dockerfile and deploying container to Cloud Run service [appointease] in project [appointease-prod-457922] region [southamerica-west1]
|  Building and deploying... Uploading sources.                                                                                                                                             
/  Building and deploying... Uploading sources.                                                                                                                                             
OK Building and deploying... Done.                                                                                                                                                          
  OK Uploading sources...                                                                                                                                                                   
  OK Building Container... Logs are available at [https://console.cloud.google.com/cloud-build/builds;region=southamerica-west1/67e9d8ff-a872-46ad-beb5-86007e739575?project=249754346416]. 
  OK Creating Revision...                                                                                                                                                                   
  OK Routing traffic...                                                                                                                                                                     
  OK Setting IAM Policy...                                                                                                                                                                  
Done.                                                                                                                                                                                       
Service [appointease] revision [appointease-00053-b9j] has been deployed and is serving 100 percent of traffic.
Service URL: https://appointease-249754346416.southamerica-west1.run.app
saasb2c1@cloudshell:~/business-management-system/simplified-app (appointease-prod-457922)$ 