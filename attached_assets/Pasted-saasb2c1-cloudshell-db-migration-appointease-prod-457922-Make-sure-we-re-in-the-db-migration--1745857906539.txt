saasb2c1@cloudshell:~/db-migration (appointease-prod-457922)$ # Make sure we're in the db-migration directory
cd ~/db-migration

# Ensure we still have the SOURCE_DB_URL set
export SOURCE_DB_URL="postgresql://neondb_owner:npg_wrbc48eRdZmf@ep-divine-field-a42drrxe.us-east-1.aws.neon.tech/neondb?sslmode=require"

# Run the themes fix script with JSON handling
./fix-themes-json.sh
Your active configuration is: [cloudshell-12772]
Starting Cloud SQL Auth Proxy...
Waiting for proxy to initialize...
2025/04/28 16:31:10 This is the Cloud SQL Proxy v1. It is no longer receiving active feature development. For the latest features and improvements, migrate to the v2 version of the Cloud SQL Proxy. For details, see: https://github.com/GoogleCloudPlatform/cloud-sql-proxy/blob/main/migration-guide.md
2025/04/28 16:31:10 current FDs rlimit set to 1048575, wanted limit is 8500. Nothing to do here.
2025/04/28 16:31:13 Listening on 127.0.0.1:5432 for appointease-prod-457922:southamerica-west1:appointease-db
2025/04/28 16:31:13 Ready for new connections
2025/04/28 16:31:14 Generated RSA key in 554.195271ms
Starting themes table fixer (with JSON handling)...
================================================================================
 THEMES TABLE MIGRATION FIXER (JSON HANDLING)
================================================================================

2025/04/28 16:31:21 New connection for "appointease-prod-457922:southamerica-west1:appointease-db"
2025/04/28 16:31:21 refreshing ephemeral certificate for instance appointease-prod-457922:southamerica-west1:appointease-db
2025/04/28 16:31:24 Scheduling refresh of ephemeral certificate in 54m58s
Checking if themes table exists in target database...
Dropping existing themes table in target database...
Creating themes table with correct column types...
Created themes table in target database
Fetching all themes from source...
Found 25 themes in source
Error inserting theme (ID: 1): column "category" of relation "themes" does not exist
Theme data (truncated):
  id: 1
  business_id: 7
  business_slug: downtownbarber
  name: Modern Indigo
  primary_color: #4f46e5
  secondary_color: #06b6d4
  accent_color: #f59e0b
  background_color: #ffffff
  text_color: #111827
  font_family: Inter, system-ui, sans-serif
  border_radius: 8
  spacing: 16
  button_style: default
  card_style: default
  variant: professional
  appearance: system
  is_active: true
  is_preset: false
  industry_type: null
  created_at: [Object]
  updated_at: [Object]
  is_default: true
  tokens: [Object]
  description: A sleek and professional theme...
  category: professional
  tags: [Object]
  base_theme_id: null
  preview: null
  thumbnail: null
  popularity: 0
  logo_image_url: null
Error inserting theme (ID: 2): column "category" of relation "themes" does not exist
Theme data (truncated):
  id: 2
  business_id: 7
  business_slug: downtownbarber
  name: Bold Crimson
  primary_color: #dc2626
  secondary_color: #2563eb
  accent_color: #f59e0b
  background_color: #ffffff
  text_color: #111827
  font_family: Inter, system-ui, sans-serif
  border_radius: 4
  spacing: 16
  button_style: default
  card_style: default
  variant: vibrant
  appearance: system
  is_active: false
  is_preset: false
  industry_type: null
  created_at: [Object]
  updated_at: [Object]
  is_default: false
  tokens: [Object]
  description: A bold theme with vibrant red ...
  category: vibrant
  tags: [Object]
  base_theme_id: null
  preview: null
  thumbnail: null
  popularity: 0
  logo_image_url: null
Error inserting theme (ID: 3): column "category" of relation "themes" does not exist
Theme data (truncated):
  id: 3
  business_id: 7
  business_slug: downtownbarber
  name: Elegant Emerald
  primary_color: #047857
  secondary_color: #7c3aed
  accent_color: #f59e0b
  background_color: #ffffff
  text_color: #111827
  font_family: Georgia, serif
  border_radius: 12
  spacing: 16
  button_style: default
  card_style: default
  variant: elegant
  appearance: system
  is_active: false
  is_preset: false
  industry_type: null
  created_at: [Object]
  updated_at: [Object]
  is_default: false
  tokens: [Object]
  description: An elegant theme with emerald ...
  category: elegant
  tags: [Object]
  base_theme_id: null
  preview: null
  thumbnail: null
  popularity: 0
  logo_image_url: null
Error inserting theme (ID: 4): column "category" of relation "themes" does not exist
Theme data (truncated):
  id: 4
  business_id: 7
  business_slug: downtownbarber
  name: Minimal Slate
  primary_color: #475569
  secondary_color: #94a3b8
  accent_color: #f59e0b
  background_color: #f8fafc
  text_color: #1e293b
  font_family: Inter, system-ui, sans-serif
  border_radius: 2
  spacing: 16
  button_style: default
  card_style: default
  variant: minimal
  appearance: system
  is_active: false
  is_preset: false
  industry_type: null
  created_at: [Object]
  updated_at: [Object]
  is_default: false
  tokens: [Object]
  description: A minimalist theme with slate ...
  category: minimal
  tags: [Object]
  base_theme_id: null
  preview: null
  thumbnail: null
  popularity: 0
  logo_image_url: null
Error inserting theme (ID: 5): column "category" of relation "themes" does not exist
Theme data (truncated):
  id: 5
  business_id: 7
  business_slug: downtownbarber
  name: Vibrant Fuchsia
  primary_color: #d946ef
  secondary_color: #8b5cf6
  accent_color: #f59e0b
  background_color: #ffffff
  text_color: #111827
  font_family: Inter, system-ui, sans-serif
  border_radius: 16
  spacing: 16
  button_style: default
  card_style: default
  variant: vibrant
  appearance: system
  is_active: false
  is_preset: false
  industry_type: null
  created_at: [Object]
  updated_at: [Object]
  is_default: false
  tokens: [Object]
  description: A vibrant and energetic theme ...
  category: vibrant
  tags: [Object]
  base_theme_id: null
  preview: null
  thumbnail: null
  popularity: 0
  logo_image_url: null
Error inserting theme (ID: 6): column "category" of relation "themes" does not exist
Theme data (truncated):
  id: 6
  business_id: 1
  business_slug: salonelegante
  name: Modern Indigo
  primary_color: #4f46e5
  secondary_color: #06b6d4
  accent_color: #f59e0b
  background_color: #ffffff
  text_color: #111827
  font_family: Inter, system-ui, sans-serif
  border_radius: 8
  spacing: 16
  button_style: default
  card_style: default
  variant: professional
  appearance: system
  is_active: true
  is_preset: false
  industry_type: null
  created_at: [Object]
  updated_at: [Object]
  is_default: true
  tokens: [Object]
  description: A sleek and professional theme...
  category: professional
  tags: [Object]
  base_theme_id: null
  preview: null
  thumbnail: null
  popularity: 0
  logo_image_url: null
Error inserting theme (ID: 7): column "category" of relation "themes" does not exist
Theme data (truncated):
  id: 7
  business_id: 1
  business_slug: salonelegante
  name: Bold Crimson
  primary_color: #dc2626
  secondary_color: #2563eb
  accent_color: #f59e0b
  background_color: #ffffff
  text_color: #111827
  font_family: Inter, system-ui, sans-serif
  border_radius: 4
  spacing: 16
  button_style: default
  card_style: default
  variant: vibrant
  appearance: system
  is_active: false
  is_preset: false
  industry_type: null
  created_at: [Object]
  updated_at: [Object]
  is_default: false
  tokens: [Object]
  description: A bold theme with vibrant red ...
  category: vibrant
  tags: [Object]
  base_theme_id: null
  preview: null
  thumbnail: null
  popularity: 0
  logo_image_url: null
Error inserting theme (ID: 8): column "category" of relation "themes" does not exist
Theme data (truncated):
  id: 8
  business_id: 1
  business_slug: salonelegante
  name: Elegant Emerald
  primary_color: #047857
  secondary_color: #7c3aed
  accent_color: #f59e0b
  background_color: #ffffff
  text_color: #111827
  font_family: Georgia, serif
  border_radius: 12
  spacing: 16
  button_style: default
  card_style: default
  variant: elegant
  appearance: system
  is_active: false
  is_preset: false
  industry_type: null
  created_at: [Object]
  updated_at: [Object]
  is_default: false
  tokens: [Object]
  description: An elegant theme with emerald ...
  category: elegant
  tags: [Object]
  base_theme_id: null
  preview: null
  thumbnail: null
  popularity: 0
  logo_image_url: null
Error inserting theme (ID: 9): column "category" of relation "themes" does not exist
Theme data (truncated):
  id: 9
  business_id: 1
  business_slug: salonelegante
  name: Minimal Slate
  primary_color: #475569
  secondary_color: #94a3b8
  accent_color: #f59e0b
  background_color: #f8fafc
  text_color: #1e293b
  font_family: Inter, system-ui, sans-serif
  border_radius: 2
  spacing: 16
  button_style: default
  card_style: default
  variant: minimal
  appearance: system
  is_active: false
  is_preset: false
  industry_type: null
  created_at: [Object]
  updated_at: [Object]
  is_default: false
  tokens: [Object]
  description: A minimalist theme with slate ...
  category: minimal
  tags: [Object]
  base_theme_id: null
  preview: null
  thumbnail: null
  popularity: 0
  logo_image_url: null
Error inserting theme (ID: 10): column "category" of relation "themes" does not exist
Theme data (truncated):
  id: 10
  business_id: 1
  business_slug: salonelegante
  name: Vibrant Fuchsia
  primary_color: #d946ef
  secondary_color: #8b5cf6
  accent_color: #f59e0b
  background_color: #ffffff
  text_color: #111827
  font_family: Inter, system-ui, sans-serif
  border_radius: 16
  spacing: 16
  button_style: default
  card_style: default
  variant: vibrant
  appearance: system
  is_active: false
  is_preset: false
  industry_type: null
  created_at: [Object]
  updated_at: [Object]
  is_default: false
  tokens: [Object]
  description: A vibrant and energetic theme ...
  category: vibrant
  tags: [Object]
  base_theme_id: null
  preview: null
  thumbnail: null
  popularity: 0
  logo_image_url: null
Error inserting theme (ID: 11): column "category" of relation "themes" does not exist
Theme data (truncated):
  id: 11
  business_id: 5
  business_slug: beautysalon
  name: Modern Indigo
  primary_color: #4f46e5
  secondary_color: #06b6d4
  accent_color: #f59e0b
  background_color: #ffffff
  text_color: #111827
  font_family: Inter, system-ui, sans-serif
  border_radius: 8
  spacing: 16
  button_style: default
  card_style: default
  variant: professional
  appearance: system
  is_active: true
  is_preset: false
  industry_type: null
  created_at: [Object]
  updated_at: [Object]
  is_default: true
  tokens: [Object]
  description: A sleek and professional theme...
  category: professional
  tags: [Object]
  base_theme_id: null
  preview: null
  thumbnail: null
  popularity: 0
  logo_image_url: null
Error inserting theme (ID: 12): column "category" of relation "themes" does not exist
Theme data (truncated):
  id: 12
  business_id: 5
  business_slug: beautysalon
  name: Bold Crimson
  primary_color: #dc2626
  secondary_color: #2563eb
  accent_color: #f59e0b
  background_color: #ffffff
  text_color: #111827
  font_family: Inter, system-ui, sans-serif
  border_radius: 4
  spacing: 16
  button_style: default
  card_style: default
  variant: vibrant
  appearance: system
  is_active: false
  is_preset: false
  industry_type: null
  created_at: [Object]
  updated_at: [Object]
  is_default: false
  tokens: [Object]
  description: A bold theme with vibrant red ...
  category: vibrant
  tags: [Object]
  base_theme_id: null
  preview: null
  thumbnail: null
  popularity: 0
  logo_image_url: null
Error inserting theme (ID: 13): column "category" of relation "themes" does not exist
Theme data (truncated):
  id: 13
  business_id: 5
  business_slug: beautysalon
  name: Elegant Emerald
  primary_color: #047857
  secondary_color: #7c3aed
  accent_color: #f59e0b
  background_color: #ffffff
  text_color: #111827
  font_family: Georgia, serif
  border_radius: 12
  spacing: 16
  button_style: default
  card_style: default
  variant: elegant
  appearance: system
  is_active: false
  is_preset: false
  industry_type: null
  created_at: [Object]
  updated_at: [Object]
  is_default: false
  tokens: [Object]
  description: An elegant theme with emerald ...
  category: elegant
  tags: [Object]
  base_theme_id: null
  preview: null
  thumbnail: null
  popularity: 0
  logo_image_url: null
Error inserting theme (ID: 14): column "category" of relation "themes" does not exist
Theme data (truncated):
  id: 14
  business_id: 5
  business_slug: beautysalon
  name: Minimal Slate
  primary_color: #475569
  secondary_color: #94a3b8
  accent_color: #f59e0b
  background_color: #f8fafc
  text_color: #1e293b
  font_family: Inter, system-ui, sans-serif
  border_radius: 2
  spacing: 16
  button_style: default
  card_style: default
  variant: minimal
  appearance: system
  is_active: false
  is_preset: false
  industry_type: null
  created_at: [Object]
  updated_at: [Object]
  is_default: false
  tokens: [Object]
  description: A minimalist theme with slate ...
  category: minimal
  tags: [Object]
  base_theme_id: null
  preview: null
  thumbnail: null
  popularity: 0
  logo_image_url: null
Error inserting theme (ID: 15): column "category" of relation "themes" does not exist
Theme data (truncated):
  id: 15
  business_id: 5
  business_slug: beautysalon
  name: Vibrant Fuchsia
  primary_color: #d946ef
  secondary_color: #8b5cf6
  accent_color: #f59e0b
  background_color: #ffffff
  text_color: #111827
  font_family: Inter, system-ui, sans-serif
  border_radius: 16
  spacing: 16
  button_style: default
  card_style: default
  variant: vibrant
  appearance: system
  is_active: false
  is_preset: false
  industry_type: null
  created_at: [Object]
  updated_at: [Object]
  is_default: false
  tokens: [Object]
  description: A vibrant and energetic theme ...
  category: vibrant
  tags: [Object]
  base_theme_id: null
  preview: null
  thumbnail: null
  popularity: 0
  logo_image_url: null
Error inserting theme (ID: 16): column "category" of relation "themes" does not exist
Theme data (truncated):
  id: 16
  business_id: 6
  business_slug: acmespa
  name: Modern Indigo
  primary_color: #4f46e5
  secondary_color: #06b6d4
  accent_color: #f59e0b
  background_color: #ffffff
  text_color: #111827
  font_family: Inter, system-ui, sans-serif
  border_radius: 8
  spacing: 16
  button_style: default
  card_style: default
  variant: professional
  appearance: system
  is_active: true
  is_preset: false
  industry_type: null
  created_at: [Object]
  updated_at: [Object]
  is_default: true
  tokens: [Object]
  description: A sleek and professional theme...
  category: professional
  tags: [Object]
  base_theme_id: null
  preview: null
  thumbnail: null
  popularity: 0
  logo_image_url: null
Error inserting theme (ID: 17): column "category" of relation "themes" does not exist
Theme data (truncated):
  id: 17
  business_id: 6
  business_slug: acmespa
  name: Bold Crimson
  primary_color: #dc2626
  secondary_color: #2563eb
  accent_color: #f59e0b
  background_color: #ffffff
  text_color: #111827
  font_family: Inter, system-ui, sans-serif
  border_radius: 4
  spacing: 16
  button_style: default
  card_style: default
  variant: vibrant
  appearance: system
  is_active: false
  is_preset: false
  industry_type: null
  created_at: [Object]
  updated_at: [Object]
  is_default: false
  tokens: [Object]
  description: A bold theme with vibrant red ...
  category: vibrant
  tags: [Object]
  base_theme_id: null
  preview: null
  thumbnail: null
  popularity: 0
  logo_image_url: null
Error inserting theme (ID: 18): column "category" of relation "themes" does not exist
Theme data (truncated):
  id: 18
  business_id: 6
  business_slug: acmespa
  name: Elegant Emerald
  primary_color: #047857
  secondary_color: #7c3aed
  accent_color: #f59e0b
  background_color: #ffffff
  text_color: #111827
  font_family: Georgia, serif
  border_radius: 12
  spacing: 16
  button_style: default
  card_style: default
  variant: elegant
  appearance: system
  is_active: false
  is_preset: false
  industry_type: null
  created_at: [Object]
  updated_at: [Object]
  is_default: false
  tokens: [Object]
  description: An elegant theme with emerald ...
  category: elegant
  tags: [Object]
  base_theme_id: null
  preview: null
  thumbnail: null
  popularity: 0
  logo_image_url: null
Error inserting theme (ID: 19): column "category" of relation "themes" does not exist
Theme data (truncated):
  id: 19
  business_id: 6
  business_slug: acmespa
  name: Minimal Slate
  primary_color: #475569
  secondary_color: #94a3b8
  accent_color: #f59e0b
  background_color: #f8fafc
  text_color: #1e293b
  font_family: Inter, system-ui, sans-serif
  border_radius: 2
  spacing: 16
  button_style: default
  card_style: default
  variant: minimal
  appearance: system
  is_active: false
  is_preset: false
  industry_type: null
  created_at: [Object]
  updated_at: [Object]
  is_default: false
  tokens: [Object]
  description: A minimalist theme with slate ...
  category: minimal
  tags: [Object]
  base_theme_id: null
  preview: null
  thumbnail: null
  popularity: 0
  logo_image_url: null
Error inserting theme (ID: 20): column "category" of relation "themes" does not exist
Theme data (truncated):
  id: 20
  business_id: 6
  business_slug: acmespa
  name: Vibrant Fuchsia
  primary_color: #d946ef
  secondary_color: #8b5cf6
  accent_color: #f59e0b
  background_color: #ffffff
  text_color: #111827
  font_family: Inter, system-ui, sans-serif
  border_radius: 16
  spacing: 16
  button_style: default
  card_style: default
  variant: vibrant
  appearance: system
  is_active: false
  is_preset: false
  industry_type: null
  created_at: [Object]
  updated_at: [Object]
  is_default: false
  tokens: [Object]
  description: A vibrant and energetic theme ...
  category: vibrant
  tags: [Object]
  base_theme_id: null
  preview: null
  thumbnail: null
  popularity: 0
  logo_image_url: null
Error inserting theme (ID: 21): column "category" of relation "themes" does not exist
Theme data (truncated):
  id: 21
  business_id: 11
  business_slug: prideandflow
  name: Modern Indigo
  primary_color: #4f46e5
  secondary_color: #06b6d4
  accent_color: #f59e0b
  background_color: #ffffff
  text_color: #111827
  font_family: Inter, system-ui, sans-serif
  border_radius: 8
  spacing: 16
  button_style: default
  card_style: default
  variant: professional
  appearance: system
  is_active: true
  is_preset: false
  industry_type: null
  created_at: [Object]
  updated_at: [Object]
  is_default: true
  tokens: [Object]
  description: A sleek and professional theme...
  category: professional
  tags: [Object]
  base_theme_id: null
  preview: null
  thumbnail: null
  popularity: 0
  logo_image_url: null
Error inserting theme (ID: 22): column "category" of relation "themes" does not exist
Theme data (truncated):
  id: 22
  business_id: 11
  business_slug: prideandflow
  name: Bold Crimson
  primary_color: #dc2626
  secondary_color: #2563eb
  accent_color: #f59e0b
  background_color: #ffffff
  text_color: #111827
  font_family: Inter, system-ui, sans-serif
  border_radius: 4
  spacing: 16
  button_style: default
  card_style: default
  variant: vibrant
  appearance: system
  is_active: false
  is_preset: false
  industry_type: null
  created_at: [Object]
  updated_at: [Object]
  is_default: false
  tokens: [Object]
  description: A bold theme with vibrant red ...
  category: vibrant
  tags: [Object]
  base_theme_id: null
  preview: null
  thumbnail: null
  popularity: 0
  logo_image_url: null
Error inserting theme (ID: 23): column "category" of relation "themes" does not exist
Theme data (truncated):
  id: 23
  business_id: 11
  business_slug: prideandflow
  name: Elegant Emerald
  primary_color: #047857
  secondary_color: #7c3aed
  accent_color: #f59e0b
  background_color: #ffffff
  text_color: #111827
  font_family: Georgia, serif
  border_radius: 12
  spacing: 16
  button_style: default
  card_style: default
  variant: elegant
  appearance: system
  is_active: false
  is_preset: false
  industry_type: null
  created_at: [Object]
  updated_at: [Object]
  is_default: false
  tokens: [Object]
  description: An elegant theme with emerald ...
  category: elegant
  tags: [Object]
  base_theme_id: null
  preview: null
  thumbnail: null
  popularity: 0
  logo_image_url: null
Error inserting theme (ID: 24): column "category" of relation "themes" does not exist
Theme data (truncated):
  id: 24
  business_id: 11
  business_slug: prideandflow
  name: Minimal Slate
  primary_color: #475569
  secondary_color: #94a3b8
  accent_color: #f59e0b
  background_color: #f8fafc
  text_color: #1e293b
  font_family: Inter, system-ui, sans-serif
  border_radius: 2
  spacing: 16
  button_style: default
  card_style: default
  variant: minimal
  appearance: system
  is_active: false
  is_preset: false
  industry_type: null
  created_at: [Object]
  updated_at: [Object]
  is_default: false
  tokens: [Object]
  description: A minimalist theme with slate ...
  category: minimal
  tags: [Object]
  base_theme_id: null
  preview: null
  thumbnail: null
  popularity: 0
  logo_image_url: null
Error inserting theme (ID: 25): column "category" of relation "themes" does not exist
Theme data (truncated):
  id: 25
  business_id: 11
  business_slug: prideandflow
  name: Vibrant Fuchsia
  primary_color: #d946ef
  secondary_color: #8b5cf6
  accent_color: #f59e0b
  background_color: #ffffff
  text_color: #111827
  font_family: Inter, system-ui, sans-serif
  border_radius: 16
  spacing: 16
  button_style: default
  card_style: default
  variant: vibrant
  appearance: system
  is_active: false
  is_preset: false
  industry_type: null
  created_at: [Object]
  updated_at: [Object]
  is_default: false
  tokens: [Object]
  description: A vibrant and energetic theme ...
  category: vibrant
  tags: [Object]
  base_theme_id: null
  preview: null
  thumbnail: null
  popularity: 0
  logo_image_url: null

Themes migration summary:
✓ Successfully inserted: 0 themes
✗ Failed to insert: 25 themes
Source records: 25
Target records: 0
✗ Theme counts mismatch: Source=25, Target=0
2025/04/28 16:31:28 Client closed local connection on 127.0.0.1:5432
Process completed. Stopping Cloud SQL Auth Proxy...
2025/04/28 16:31:28 Received TERM signal. Waiting up to 0s before terminating.
saasb2c1@cloudshell:~/db-migration (appointease-prod-457922)$ 