saasb2c1@cloudshell:~/business-management-system (appointease-prod-457922)$ # Create a simplified server file for testing
mkdir -p test-server
cat > test-server/index.js << 'EOF'
const express = require('express');
const app = express();
const port = process.env.PORT || 8080;

console.log('Database URL:', process.env.DATABASE_URL?.substring(0, 10) + '...');

app.get('/', (req, res) => {
  res.send('AppointEase Test Server Running Successfully');
});

app.get('/env', (req, res) => {
  res.json({
    environment: process.env.NODE_ENV,
    databaseConnected: Boolean(process.env.DATABASE_URL),
    port: port
  });
});

app.listen(port, '0.0.0.0', () => {
  console.log(`Test server listening on port ${port}`);
});
EOF

# Create a minimal package.json
cat > test-server/package.json << 'EOF'
{
  "name": "appointease-test",
  "version": "1.0.0",
  "main": "index.js",
  "scripts": {
    "start": "node index.js"
  },
  "dependencies": {
    "express": "^4.18.2"
  --update-secrets="DATABASE_URL=database-url:latest"
Building using Dockerfile and deploying container to Cloud Run service [appointease-test] in project [appointease-prod-457922] region [southamerica-west1]
\  Building and deploying new service... Uploading sources.                                                                                                                                 
  \  Uploading sources...                                                                                                                                                                   
X  Building and deploying new service... Building Container.                                                                                                                                
  OK Uploading sources...                                                                                                                                                                   
  OK Building Container... Logs are available at [https://console.cloud.google.com/cloud-build/builds;region=southamerica-west1/80d902cc-5d1b-4c71-a530-33b739a8aa78?project=249754346416]. 
  -  Creating Revision...                                                                                                                                                                   
Creating temporary archive of 3 file(s) totalling 848 bytes before compression.
  OK Setting IAM Policy...                                                                                                                                                                  
Deployment failed                                                                                                                                                                           
ERROR: (gcloud.run.deploy) Revision 'appointease-test-00001-5pl' is not ready and cannot serve traffic. spec.template.spec.containers[0].env[1].value_from.secret_key_ref.name: Permission denied on secret: projects/249754346416/secrets/database-url/versions/latest for Revision service account 249754346416-compute@developer.gserviceaccount.com. The service account used must be granted the 'Secret Manager Secret Accessor' role (roles/secretmanager.secretAccessor) at the secret, project or higher level.
saasb2c1@cloudshell:~/business-management-system/test-server (appointease-prod-457922)$ 