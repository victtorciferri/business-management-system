saasb2c1@cloudshell:~/business-management-system/simplified-app (appointease-prod-457922)$ # Go to the simplified app directory
cd ~/business-management-system/simplified-app

# Create a script to check for your businesses in the database
cat > check-businesses.js << 'EOF'
const { Pool } = require('pg');

// Database connection
const pool = new Pool({
  connectionString: process.env.DATABASE_URL,
  ssl: process.env.NODE_ENV === 'production' && 
       !process.env.DATABASE_URL.includes('localhost') ? 
       { rejectUnauthorized: false } : false
});

async function checkBusinesses() {
  try {
    console.log('Checking for businesses in the database...');
    
    const client = await pool.connect();
    
    // Check users table for business information
    const usersResult = await client.query(`
      SELECT id, username, business_name, business_slug, role
      FROM users
      WHERE business_slug IS NOT NULL
    `);
    
    console.log('Found businesses:');
    if (usersResult.rows.length === 0) {
      console.log('No businesses found in users table');
    } else {
      usersResult.rows.forEach(user => {
        console.log(`- ID: ${user.id}, Username: ${user.username}, Business: ${user.business_name}, Slug: ${user.business_slug}, Role: ${user.role}`);
      });
    }
    
  --add-cloudsql-instances=${INSTANCE_CONNECTION_NAME}\pointease-secret-key,CLOUD_SQL_CONNECTION_NAME=${INSTANCE_CONNECTION_NAME}" \
Checking for businesses in the database...
Error checking businesses: Error: connect ECONNREFUSED 127.0.0.1:5432
    at /home/saasb2c1/business-management-system/simplified-app/node_modules/pg-pool/index.js:45:11
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
    at async checkBusinesses (/home/saasb2c1/business-management-system/simplified-app/check-businesses.js:15:20) {
  errno: -111,
  code: 'ECONNREFUSED',
  syscall: 'connect',
  address: '127.0.0.1',
  port: 5432
}
Building using Dockerfile and deploying container to Cloud Run service [appointease] in project [appointease-prod-457922] region [southamerica-west1]
\  Building and deploying... Uploading sources.                                                                                                                                             
|  Building and deploying... Uploading sources.                                                                                                                                             
OK Building and deploying... Done.                                                                                                                                                          
  OK Uploading sources...                                                                                                                                                                   
  OK Building Container... Logs are available at [https://console.cloud.google.com/cloud-build/builds;region=southamerica-west1/6b497e9c-5e92-4c39-b612-ed38e869fd0e?project=249754346416]. 
  OK Creating Revision...                                                                                                                                                                   
  OK Routing traffic...                                                                                                                                                                     
  OK Setting IAM Policy...                                                                                                                                                                  
Done.                                                                                                                                                                                       
Service [appointease] revision [appointease-00055-jqx] has been deployed and is serving 100 percent of traffic.
Service URL: https://appointease-249754346416.southamerica-west1.run.app
saasb2c1@cloudshell:~/business-management-system/simplified-app (appointease-prod-457922)$ 