saasb2c1@cloudshell:~/db-migration (appointease-prod-457922)$ # Create a proper start-with-db.sh script
cd ~/appointease-frontend

cat > start-with-db.sh << 'EOF'
#!/bin/bash
set -e

echo "Starting AppointEase with database connection..."

# Start Cloud SQL Auth Proxy
if [ -n "$CLOUD_SQL_CONNECTION_NAME" ]; then
  echo "Starting Cloud SQL Auth Proxy for $CLOUD_SQL_CONNECTION_NAME..."
  cloud_sql_proxy -instances=$CLOUD_SQL_CONNECTION_NAME=tcp:5432 &
  PROXY_PID=$!
  echo "Cloud SQL Auth Proxy started with PID: $PROXY_PID"
  
  # Wait for proxy to initialize
  echo "Waiting for proxy to initialize..."
  sleep 10
  echo "Proxy initialization wait completed"
fi

# Set DATABASE_URL based on proxy
if [ -z "$DATABASE_URL" ]; then
  export DATABASE_URL="postgresql://postgres:AppointEase123!@localhost:5432/postgres"
  echo "DATABASE_URL not provided, using default: $DATABASE_URL"
else
  echo "Using provided DATABASE_URL"
fi

# Print debug info
echo "NODE_ENV: $NODE_ENV"
echo "DATABASE_URL is configured (value hidden for security)"
echo "Starting application server..."

# Start the application
node server.js
  --add-cloudsql-instances=${INSTANCE_CONNECTION_NAME}tgresql://postgres:AppointEase123!@localhost:5432/postgres,CLOUD_SQL_CONNECTION_NAME=${INSTANCE_CONNECTION_NAME}" \
-bash: !@localhost: event not found
Building using Dockerfile and deploying container to Cloud Run service [appointease] in project [appointease-prod-457922] region [southamerica-west1]
\  Building and deploying... Uploading sources.                                                                                                                                             
/  Building and deploying... Uploading sources.                                                                                                                                             
OK Building and deploying... Done.                                                                                                                                                          
  OK Uploading sources...                                                                                                                                                                   
  OK Building Container... Logs are available at [https://console.cloud.google.com/cloud-build/builds;region=southamerica-west1/375d30e8-af7b-4dd5-8e90-2b3f55bd06e7?project=249754346416]. 
  OK Creating Revision...                                                                                                                                                                   
  OK Routing traffic...                                                                                                                                                                     
  OK Setting IAM Policy...                                                                                                                                                                  
Done.                                                                                                                                                                                       
Service [appointease] revision [appointease-00077-chq] has been deployed and is serving 100 percent of traffic.
Service URL: https://appointease-249754346416.southamerica-west1.run.app
saasb2c1@cloudshell:~/appointease-frontend (appointease-prod-457922)$ 