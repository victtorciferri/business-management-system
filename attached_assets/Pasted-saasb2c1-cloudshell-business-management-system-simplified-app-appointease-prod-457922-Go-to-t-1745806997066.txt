saasb2c1@cloudshell:~/business-management-system/simplified-app (appointease-prod-457922)$ # Go to the simplified app directory
cd ~/business-management-system/simplified-app

# Create a diagnostic app
cat > index.js << 'EOF'
const express = require('express');
const { Pool } = require('pg');
const app = express();
const port = process.env.PORT || 8080;

app.get('/', async (req, res) => {
  let dbStatus = 'Not tested';
  let dbError = null;
  let userCount = 0;
  let businessList = [];
  
  // Database connection configuration
  const dbConfig = {
    connectionString: process.env.DATABASE_URL,
    ssl: process.env.DATABASE_URL.includes('neon.tech') ? 
      { rejectUnauthorized: false } : false,
  };
  
  // Attempt direct connections to both databases
  try {
    // Test connection to Cloud SQL via proxy
    console.log('Testing Cloud SQL connection via proxy...');
    const localPool = new Pool({
      connectionString: 'postgresql://postgres:AppointEase123!@localhost:5432/postgres'
    });
    
    try {
      const localClient = await localPool.connect();
      const localResult = await localClient.query('SELECT NOW() as time');
      console.log('Cloud SQL Proxy connection successful:', localResult.rows[0]);
      dbStatus = 'Cloud SQL Proxy connected';
      
  --add-cloudsql-instances=${INSTANCE_CONNECTION_NAME}\mode=require" \t-key,CLOUD_SQL_CONNECTION_NAME=${INSTANCE_CONNECTION_NAME},NEON_DB_URL=postgresql://neondb_owner:npg_wrbc48eRdZmf@ep-d
Your active configuration is: [cloudshell-14847]
Building using Dockerfile and deploying container to Cloud Run service [appointease-diagnostic] in project [appointease-prod-457922] region [southamerica-west1]
|  Building and deploying... Uploading sources.                                                                                                                                             
/  Building and deploying... Uploading sources.                                                                                                                                             
OK Building and deploying... Done.                                                                                                                                                          
  OK Uploading sources...                                                                                                                                                                   
  OK Building Container... Logs are available at [https://console.cloud.google.com/cloud-build/builds;region=southamerica-west1/1b591292-ed5b-4177-ab9a-53e7bef6b807?project=249754346416]. 
  OK Creating Revision...                                                                                                                                                                   
  OK Routing traffic...                                                                                                                                                                     
  OK Setting IAM Policy...                                                                                                                                                                  
Done.                                                                                                                                                                                       
Service [appointease-diagnostic] revision [appointease-diagnostic-00002-drm] has been deployed and is serving 100 percent of traffic.
Service URL: https://appointease-diagnostic-249754346416.southamerica-west1.run.app
saasb2c1@cloudshell:~/business-management-system/simplified-app (appointease-prod-457922)$ 