saasb2c1@cloudshell:~/business-management-system/simplified-app (appointease-prod-457922)$ # Go to the simplified app directory
cd ~/business-management-system/simplified-app

# First, we need to add Cloud SQL connection capabilities to Cloud Run
# Enable the Cloud SQL Admin API
gcloud services enable sqladmin.googleapis.com

# Update index.js to include a fallback authentication mechanism
cat > index.js << 'EOF'
const express = require('express');
const fs = require('fs');
const path = require('path');
const { Pool } = require('pg');
const session = require('express-session');
const memoryStore = require('memorystore')(session);
const app = express();
const port = process.env.PORT || 8080;

// In-memory fallback data
const inMemoryUsers = [{
  id: 1,
  username: 'admin',
  password: 'admin123',
  email: 'admin@example.com',
  business_name: 'AppointEase Demo',
  business_slug: 'appointease-demo',
  role: 'business_owner'
}];

// Database connection configuration
const dbConfig = {
  connectionString: process.env.DATABASE_URL,
  ssl: process.env.NODE_ENV === 'production' ? { rejectUnauthorized: false } : false,
  connectionTimeoutMillis: 5000  // 5 second timeout
};

// Create a pool that we can use later
  --update-secrets="DATABASE_URL=database-url:latest"appointease-secret-key" \ot connected (using in-memory mode)'}`);t or deployed correctly.</p>
Building using Dockerfile and deploying container to Cloud Run service [appointease] in project [appointease-prod-457922] region [southamerica-west1]
-  Building and deploying... Uploading sources.                                                                                                                                             
|  Building and deploying... Uploading sources.                                                                                                                                             
OK Building and deploying... Done.                                                                                                                                                          
  OK Uploading sources...                                                                                                                                                                   
  OK Building Container... Logs are available at [https://console.cloud.google.com/cloud-build/builds;region=southamerica-west1/55df2e45-f6a3-42ce-bfb1-fc6e3d32b9a0?project=249754346416]. 
  OK Creating Revision...                                                                                                                                                                   
  OK Routing traffic...                                                                                                                                                                     
  OK Setting IAM Policy...                                                                                                                                                                  
Done.                                                                                                                                                                                       
Service [appointease] revision [appointease-00049-9z2] has been deployed and is serving 100 percent of traffic.
Service URL: https://appointease-249754346416.southamerica-west1.run.app
saasb2c1@cloudshell:~/business-management-system/simplified-app (appointease-prod-457922)$ 