saasb2c1@cloudshell:~ (appointease-prod-457922)$ cd ~/appointease-frontend

# Update the server with a final fix for the businesses endpoint
cat > server.js << 'EOF'
const express = require('express');
const path = require('path');
const { Pool } = require('pg');

const app = express();
const port = process.env.PORT || 8080;

// Database connection setup
let pool;
let dbConnected = false;

function setupDatabaseConnection() {
  if (!process.env.DATABASE_URL) {
    console.error('DATABASE_URL environment variable not set');
    return;
  }

  try {
    console.log('Setting up database connection...');
    pool = new Pool({ connectionString: process.env.DATABASE_URL });
    
    pool.query('SELECT NOW()', (err, result) => {
      if (err) {
        console.error('Database connection error:', err.message);
        dbConnected = false;
      } else {
        console.log('Database connected successfully at:', result.rows[0].now);
        dbConnected = true;
        
        // Once connected, check the businesses table with correct column names
        pool.query('SELECT COUNT(*) FROM users WHERE business_slug IS NOT NULL', (err, result) => {
          if (err) {
            console.error('Error checking businesses:', err.message);
  --add-cloudsql-instances=$INSTANCE_CONNECTION_NAMECTION_NAME=$INSTANCE_CONNECTION_NAME \cmespa'];ers WHERE business_slug IS NOT NULL'
Your active configuration is: [cloudshell-25906]
ERROR: (gcloud.sql.instances.list) You do not currently have an active account selected.
Please run:

  $ gcloud auth login

to obtain new credentials.

If you have already logged in with a different account, run:

  $ gcloud config set account ACCOUNT

to select an already authenticated account to use.
ERROR: (gcloud.run.deploy) You do not currently have an active account selected.
Please run:

  $ gcloud auth login

to obtain new credentials.

If you have already logged in with a different account, run:

  $ gcloud config set account ACCOUNT

to select an already authenticated account to use.